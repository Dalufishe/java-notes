# Java 正規表達式

正規表達式，是一種用於 1. 校驗文本 (字串) 是否滿足一定的規則，或 2. 根據規則查找滿足要求的內容的表示法。

### 常用匹配規則

```
a             a
5             5
$             $
```

```
.             任何字符
\d            一個數字 : [0-9]
\D            非數字 : [^0-9]
\s            一個空白字符 [\t\n\x0B\f\r]
\S            非空白字符 [^\s]
\w            一個英文，數字，下划線 [a-zA-Z_0-9]
\W            非英文，數字，下划線 [^\w]
```

```
^             開頭
$             結尾
```

注意: 在 Java 中，regex 是透過字串傳入，`\` 會被視為字符串的轉義字元，需在 `\` 前加上另一個 `\` => `\\` 轉義轉義字元為無效使 `\` 為正規表達式使用。

```
[abc]         a b, c
[^abc]        非 a b, c
[a-zA-Z]      a 到 z 和 A 到 Z
[a-z[A-Z]]    a 到 z 和 A 到 Z，同上
[a-z&&[def]]  a 到 z 交集 def : def
[a-z&&[^bc]]  a 到 z 交集 非bc : [ad-z]
[a-z&&[^m-p]] a 到 z 交集 非 m 到 p : [a-lq-z]
```

```
X?            X, 1次或0次
X*            X, 0次或多次
X+            X, 1次或多次
X{n}          X, 正好n次
X{n, }        X, 至少n次
X{n,m}        X, 至少n次但不超過m次
```

### Pattern (正則物件) & Matcher (比對器)

`java.util.regex.Pattern` 在 Java 中表示正規表達式的物件型態，並記錄正規相關資訊及方法，以利於 Java 做運算。

`java.util.regex.Matcher` 在 Java 中代表文字匹配器，用於處裡正則運算，記錄了許多計算相關的方法。

#### 獲得正規表達式物件

Pattern p = Pattern.compile(String regex);

#### 常用方法

- Matcher m = p.matcher(str);
  - 返回文字匹配器對象。
  
- m.find()
  - 返回 boolean，判斷是否有滿足規則的子串。
  - 底層紀錄滿足規則的子串起始索引~結束索引+1。
  - 後續調用，會繼續讀取 str 後面的內容。
- m.group()
  - 根據 m.find() 底層紀錄的索引進行 str 的截取，並返回子串。
- m.matches()
  - 較驗字串整體是否符合規則 (str.matches 底層)

### 字串常用方法

字串定義了些許常用方法，簡化了正則的使用，並新增了些 Matcher 沒有的功能。

str.matches(String regex): 用於校驗是否滿足正規表達式。
str.replaceAll(String regex, String newStr): 按正則表達式進行替換。
str.replaceFirst(String regex, String newStr): 按正則表達式進行替換，僅一個。
str.split(String regex): 按正則表達式進行替換。按正則表達式進行拆分。

### 帶條件匹配

```
(?i)abc       abc, 帶條件匹配, 忽略大小寫
a(?i)bc       bc, 帶條件匹配, 忽略大小寫
a((?i)b)c     b, 帶條件匹配, 忽略大小寫
```

```
Java(?=8|11)  Java, 帶條件匹配, 後面需有 8 或 11，但不獲取 (查找時) 8 或 11
Java(?:8|11)  Java, 帶條件匹配, 後面需有 8 或 11，並獲取 (查找時) 8 或 11 (等同於 Java(8|11) 的非捕獲分組型態)
Java(?!8|11)  Java, 帶條件匹配, 後面不能有 8 或 11，並不獲取 (查找時) 8 或 11
```

### 貪婪 vs 非貪婪

貪婪: 盡可能多獲取 
非貪婪: 盡可能少獲取

```
X?            X, 1次或0次, 貪婪
X??           X, 1次或0次, 非貪婪
X*            X, 0次或多次, 貪婪
X*?           X, 0次或多次, 非貪婪
X+            X, 1次或多次, 貪婪
X+?           X, 1次或多次, 非貪婪
X{n}          X, 正好n次, 貪婪
X{n}?         X, 正好n次, 非貪婪
X{n, }        X, 至少n次, 貪婪
X{n, }?       X, 至少n次, 非貪婪
X{n,m}        X, 至少n次但不超過m次, 貪婪
X{n,m}?       X, 至少n次但不超過m次, 非貪婪
```

### 捕獲分組

在正規表達式中，會使用 () 進行捕獲分組。

```
(\d+)(a|b)
```

每組是有組號的，也就是序號。

序號為從 1 開始，每遇到左括號遞增。

```
(\d+(\w+))(a|b)

\d+(\w+) 為第一組
\w+      為第二組
a|b      為第三組
```

捕獲分組除了用於區分，也設計來處裡一致性問題，如 a123a, bb333bb。

他能夠透過標記 (\,  $) 來復用了先前分組的內容。

正則內用 `/`:
```
(.).+/1     /1, 捕獲第一分組
```

正則外用 `$`:
```java
String str = "我要學學學學學編編編編編程程程程";

String result = str.replaceAll(
        "(.)\\1+",
        "$1"
);

System.out.println(result);

```

### 非捕獲分組

非捕獲分組僅僅將數據括起來 (僅僅用來區分)，並不占用序號，也不會被標記指向他。

```
Java(?:8|11) : 為了和 Java(8|11) 區分 (捕獲分組)

Java(?=8|11) : 不獲取條件匹配沒必要捕獲
Java(?!8|11) : 不獲取條件匹配沒必要捕獲
```